@use "variables" as *;

// === DARK MODE SYSTEM ===

// Dark mode color variables
:root {
  // Light mode (default)
  --bg-primary: #{$goepik-background};        // #f8f9fa
  --bg-secondary: #ffffff;                    // Cards, containers
  --bg-tertiary: #f5f5f5;                     // Subtle backgrounds
  --bg-quaternary: #fafafa;                   // Tab nav backgrounds
  
  --text-primary: #{$goepik-dark};            // #2c3e50
  --text-secondary: #{$goepik-medium};        // #7f8c8d  
  --text-tertiary: #{$goepik-light};          // #bdc3c7
  
  --border-primary: #{$goepik-border};        // #ecf0f1
  --border-secondary: #e8e8e8;               // Subtle borders
  --border-tertiary: #ddd;                   // Lighter borders
  
  --shadow-sm: #{shadow(sm)};
  --shadow-md: #{shadow(md)};
  --shadow-lg: #{shadow(lg)};
  
  // Interactive states
  --hover-bg: rgba(67, 205, 178, 0.04);
  --active-bg: rgba(67, 205, 178, 0.08);
  --focus-ring: rgba(67, 205, 178, 0.15);
  
  // Status colors (maintain in both modes)
  --success-color: #{$goepik-success};
  --warning-color: #{$goepik-warning};
  --error-color: #{$goepik-error};
  --info-color: #{$goepik-info};
}

// Dark mode variables
body.dark {
  --bg-primary: #0f0f0f;                      // Main background
  --bg-secondary: #1a1a1a;                    // Cards, containers
  --bg-tertiary: #2a2a2a;                     // Subtle backgrounds
  --bg-quaternary: #1e1e1e;                   // Tab nav backgrounds
  
  --text-primary: #f0f0f0;                    // Main text
  --text-secondary: #b0b0b0;                  // Secondary text
  --text-tertiary: #808080;                   // Tertiary text
  
  --border-primary: #333333;                  // Main borders
  --border-secondary: #404040;               // Subtle borders
  --border-tertiary: #4a4a4a;                // Lighter borders
  
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.5);
  
  // Interactive states
  --hover-bg: rgba(67, 205, 178, 0.08);
  --active-bg: rgba(67, 205, 178, 0.12);
  --focus-ring: rgba(67, 205, 178, 0.25);
  
  // Background texture
  background-color: var(--bg-primary);
  background-image: radial-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px);
  color: var(--text-primary);
}

// Base element dark mode styles
body.dark {
  // Global text and background
  color: var(--text-primary);
  background-color: var(--bg-primary);
  
  // Links
  a {
    color: $goepik-primary;
    
    &:hover {
      color: $goepik-primary-hover;
    }
  }
  
  // Form elements
  input, textarea, select {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    color: var(--text-primary);
    
    &::placeholder {
      color: var(--text-tertiary);
    }
    
    &:focus {
      border-color: $goepik-primary;
      box-shadow: 0 0 0 2px var(--focus-ring);
    }
  }
  
  // Buttons (enhance existing styles)
  button:not(.ant-btn) {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    color: var(--text-primary);
    
    &:hover:not(:disabled) {
      background-color: var(--hover-bg);
    }
    
    &:active:not(:disabled) {
      background-color: var(--active-bg);
    }
  }
}

// Component-specific dark mode styles
body.dark {
  // Sidebar enhancements
  .sidebar {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
  }
  
  // Dashboard components
  .dashboard-wrapper {
    background-color: transparent;
  }
  
  .dashboard-tabs {
    background: var(--card-bg, #1a1a1a) !important;
    border-color: var(--border-color, #333) !important;
    box-shadow: none !important;
    
    .ant-tabs-nav {
      background: var(--bg-tertiary, #2a2a2a) !important;
    }
    
    .ant-tabs-content-holder {
      background: transparent !important;
    }
    
    // Fix específico para mobile
    @media (max-width: breakpoint(small-mobile)) { // 425px
      background: var(--card-bg, #1a1a1a) !important;
      background-color: var(--card-bg, #1a1a1a) !important;
      border: 1px solid var(--border-color, #333) !important;
      box-shadow: none !important;
      
      .ant-tabs-nav,
      .ant-tabs-content-holder {
        background: transparent !important;
        background-color: transparent !important;
      }
    }
  }
  
  .overview-card {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    box-shadow: var(--shadow-sm);
    
    &:hover {
      box-shadow: var(--shadow-md);
      border-color: var(--border-secondary);
    }
    
    .overview-text h3 {
      color: var(--text-primary);
    }
    
    .overview-text p {
      color: var(--text-secondary);
    }
  }
  
  // Table components
  .table-container {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    box-shadow: var(--shadow-sm);
  }
  
  .ant-table {
    background-color: var(--bg-secondary);
    
    .ant-table-thead > tr > th {
      background-color: var(--bg-tertiary);
      border-color: var(--border-primary);
      color: var(--text-primary);
      
      // Column sorting arrows and hover states
      &:hover {
        background-color: var(--hover-bg);
        color: $goepik-primary;
      }
      
      &.ant-table-column-sort {
        background-color: var(--hover-bg);
      }
      
      // Sorting indicators
      .ant-table-column-sorter {
        color: var(--text-tertiary);
        
        &-up,
        &-down {
          &.active {
            color: $goepik-primary;
          }
        }
      }
      
      // Filter dropdown trigger
      .ant-table-filter-trigger {
        color: var(--text-secondary);
        
        &:hover {
          color: $goepik-primary;
        }
        
        &.active {
          color: $goepik-primary;
        }
      }
    }
    
    .ant-table-tbody > tr > td {
      background-color: var(--bg-secondary);
      border-color: var(--border-primary);
      color: var(--text-primary);
    }
    
    .ant-table-tbody > tr:hover > td {
      background-color: var(--hover-bg);
    }
  }
  
  // Mobile record cards
  .record-card {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    box-shadow: var(--shadow-sm);
    
    &:hover {
      box-shadow: var(--shadow-md);
    }
    
    .record-header {
      border-color: var(--border-primary);
      color: var(--text-primary);
    }
    
    .record-details p {
      border-color: var(--border-primary);
      
      strong {
        color: var(--text-secondary);
      }
      
      span {
        color: var(--text-primary);
      }
    }
  }
  
  // Forms and modals
  .ant-modal-content {
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    border: 1px solid var(--border-primary);
  }
  
  .ant-modal-header {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    
    .ant-modal-title {
      color: var(--text-primary);
    }
    
    .ant-modal-close {
      color: var(--text-secondary);
      
      &:hover {
        color: var(--text-primary);
      }
    }
  }
  
  .ant-modal-footer {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    
    // Botões no dark mode mantêm cores do design system
    .ant-btn-primary {
      background-color: $goepik-primary !important;
      border-color: $goepik-primary !important;
      color: white !important;
      
      &:hover,
      &:focus {
        background-color: $goepik-primary-hover !important;
        border-color: $goepik-primary-hover !important;
        color: white !important;
      }
      
      &:active {
        background-color: $goepik-primary-dark !important;
        border-color: $goepik-primary-dark !important;
      }
    }
    
    .ant-btn-default {
      background-color: var(--bg-tertiary, #2a2a2a) !important;
      border-color: var(--border-color, #333) !important;
      color: var(--text-color, #f0f0f0) !important;
      
      &:hover,
      &:focus {
        background-color: var(--hover-bg, #3a3a3a) !important;
        border-color: $goepik-primary !important;
        color: $goepik-primary !important;
      }
      
      &:active {
        background-color: var(--active-bg, #4a4a4a) !important;
      }
    }
  }
  
  .ant-modal-body {
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    
    p {
      color: var(--text-primary);
    }
  }
  
  // Custom input masked - increased specificity 
  .justificativa-modal .ant-input-masked,
  .ant-modal-body .ant-input-masked {
    background-color: var(--bg-secondary) !important;
    border-color: var(--border-primary) !important;
    color: var(--text-primary) !important;
    
    &::placeholder {
      color: var(--text-tertiary) !important;
    }
    
    &:focus,
    &:hover {
      border-color: $goepik-primary !important;
      box-shadow: 0 0 0 2px var(--focus-ring) !important;
    }
    
    &[disabled] {
      background-color: var(--bg-tertiary) !important;
      color: var(--text-tertiary) !important;
    }
  }
  
  // Force visibility for all modal elements
  .ant-modal .ant-modal-body * {
    color: inherit;
  }
  
  .ant-modal .ant-modal-body p,
  .ant-modal .ant-modal-body strong,
  .ant-modal .ant-modal-body b {
    color: var(--text-primary) !important;
  }
  
  // Fix específico para títulos do Ant Design Typography em dark mode
  .ant-typography {
    color: var(--text-color, #f0f0f0) !important;
    
    &.title {
      color: var(--text-color, #f0f0f0) !important;
    }
    
    h1, h2, h3, h4, h5, h6 {
      color: var(--text-color, #f0f0f0) !important;
      
      &.title {
        color: var(--text-color, #f0f0f0) !important;
      }
    }
  }
  
  // Seletor ultra-específico para componentes Typography do Ant Design
  h1.ant-typography,
  h2.ant-typography,
  h3.ant-typography,
  h4.ant-typography,
  h5.ant-typography,
  h6.ant-typography {
    color: var(--text-color, #f0f0f0) !important;
    
    &.title {
      color: var(--text-color, #f0f0f0) !important;
    }
  }
  
  // Capturar qualquer elemento com classes CSS-in-JS do Ant Design
  [class*="ant-typography"][class*="css-"] {
    color: var(--text-color, #f0f0f0) !important;
    
    &.title {
      color: var(--text-color, #f0f0f0) !important;
    }
  }
  
  // Topbar
  .topbar {
    background-color: var(--bg-secondary);
    border-color: var(--border-primary);
    box-shadow: var(--shadow-sm);
  }
  
  .profile-user .user-info .user-name {
    color: var(--text-primary);
  }
  
  .profile-user .user-info .user-role {
    color: var(--text-secondary);
  }
  
  // Pagination
  .ant-pagination {
    color: var(--text-primary);
    
    .ant-pagination-total-text {
      color: var(--text-primary) !important;
    }
    
    .ant-pagination-item {
      background-color: var(--bg-secondary);
      border-color: var(--border-primary);
      
      a {
        color: var(--text-primary);
      }
      
      &:hover {
        background-color: var(--hover-bg);
        border-color: $goepik-primary;
      }
    }
    
    .ant-pagination-item-active {
      background-color: $goepik-primary;
      border-color: $goepik-primary;
      
      a {
        color: white;
      }
    }
    
    .ant-pagination-prev,
    .ant-pagination-next {
      background-color: var(--bg-secondary);
      border-color: var(--border-primary);
      
      .ant-pagination-item-link {
        background-color: transparent;
        color: var(--text-primary);
      }
      
      &:hover .ant-pagination-item-link {
        background-color: var(--hover-bg);
        color: $goepik-primary;
      }
    }
    
    .ant-pagination-options {
      .ant-select {
        .ant-select-selector {
          background-color: var(--bg-secondary);
          border-color: var(--border-primary);
          color: var(--text-primary);
        }
      }
      
      .ant-pagination-options-size-changer {
        color: var(--text-primary);
      }
    }
    
    .ant-pagination-jump-prev,
    .ant-pagination-jump-next {
      .ant-pagination-item-container {
        .ant-pagination-item-link-icon,
        .ant-pagination-item-ellipsis {
          color: var(--text-secondary);
        }
      }
      
      &:hover {
        .ant-pagination-item-container {
          .ant-pagination-item-link-icon {
            color: $goepik-primary;
          }
        }
      }
    }
  }
  
  // Ant Design Input components
  .ant-input,
  .ant-input-affix-wrapper,
  .ant-picker,
  .ant-select-selector,
  .ant-picker-input input {
    background-color: var(--bg-secondary) !important;
    border-color: var(--border-primary) !important;
    color: var(--text-primary) !important;
    
    &::placeholder {
      color: var(--text-tertiary) !important;
    }
    
    &:hover {
      border-color: var(--border-secondary) !important;
    }
    
    &:focus,
    &.ant-input-focused,
    &.ant-picker-focused {
      border-color: $goepik-primary !important;
      box-shadow: 0 0 0 2px var(--focus-ring) !important;
    }
  }
  
  // Date/Time picker dropdown
  .ant-picker-panel-container {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    
    .ant-picker-panel {
      background-color: var(--bg-secondary);
      
      .ant-picker-header {
        border-color: var(--border-primary);
        
        button {
          color: var(--text-primary);
          
          &:hover {
            color: $goepik-primary;
          }
        }
      }
      
      .ant-picker-content {
        .ant-picker-cell {
          color: var(--text-primary);
          
          &:hover {
            background-color: var(--hover-bg);
          }
          
          &.ant-picker-cell-selected {
            background-color: $goepik-primary;
            color: white;
          }
          
          &.ant-picker-cell-today {
            border-color: $goepik-primary;
          }
        }
      }
      
      .ant-picker-time-panel {
        .ant-picker-time-panel-column {
          ul li {
            color: var(--text-primary);
            
            &:hover {
              background-color: var(--hover-bg);
            }
            
            &.ant-picker-time-panel-cell-selected {
              background-color: $goepik-primary;
              color: white;
            }
          }
        }
      }
    }
  }
  
  // Upload component
  .ant-upload {
    .ant-btn {
      background-color: var(--bg-secondary);
      border-color: var(--border-primary);
      color: var(--text-primary);
      
      &:hover {
        background-color: var(--hover-bg);
        border-color: $goepik-primary;
        color: $goepik-primary;
      }
    }
  }
  
  .ant-upload-list {
    .ant-upload-list-item {
      background-color: var(--bg-secondary);
      border-color: var(--border-primary);
      
      .ant-upload-list-item-name {
        color: var(--text-primary);
      }
    }
  }
  
  // Ant Design Buttons
  .ant-btn {
    &:not(.ant-btn-primary):not(.ant-btn-danger) {
      background-color: var(--bg-secondary);
      border-color: var(--border-primary);
      color: var(--text-primary);
      
      &:hover {
        background-color: var(--hover-bg);
        border-color: var(--border-secondary);
        color: $goepik-primary;
      }
    }
  }
  
  // Ant Design Dropdown
  .ant-dropdown {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    
    .ant-dropdown-menu {
      background-color: var(--bg-secondary);
      
      .ant-dropdown-menu-item {
        color: var(--text-primary);
        
        &:hover {
          background-color: var(--hover-bg);
        }
      }
    }
  }
  
  // Ant Design Select
  .ant-select-dropdown {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    
    .ant-select-item {
      color: var(--text-primary);
      
      &:hover {
        background-color: var(--hover-bg);
      }
      
      &.ant-select-item-option-selected {
        background-color: rgba($goepik-primary, 0.1);
        color: $goepik-primary;
      }
    }
  }
  
  // Tabs
  .ant-tabs {
    .ant-tabs-nav {
      &::before {
        border-color: var(--border-primary);
      }
    }
    
    .ant-tabs-tab {
      color: var(--text-secondary);
      
      &:hover {
        color: $goepik-primary;
      }
    }
    
    .ant-tabs-tab-active {
      color: $goepik-primary;
    }
    
    .ant-tabs-ink-bar {
      background-color: $goepik-primary;
    }
  }
}

// Dark mode toggle animation
.theme-toggle {
  position: relative;
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  margin-right: spacing(lg);
  color: var(--text-secondary);
  transition: all duration(normal) easing(ease-out);
  border-radius: radius(md);
  padding: spacing(sm);
  
  &:hover {
    color: $goepik-primary;
    background-color: var(--hover-bg);
  }
  
  &:focus-visible {
    outline: 2px solid $goepik-primary;
    outline-offset: 2px;
  }
  
  .anticon {
    vertical-align: middle;
    transition: transform duration(normal) easing(bounce);
  }
  
  &:hover .anticon {
    transform: scale(1.1) rotate(10deg);
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  body.dark {
    --text-primary: #ffffff;
    --text-secondary: #e0e0e0;
    --border-primary: #555555;
    --bg-secondary: #000000;
  }
}

// Smooth theme transition
* {
  transition-property: background-color, border-color, color, box-shadow;
  transition-duration: duration(normal);
  transition-timing-function: easing(ease-out);
}

// Disable transitions during theme change to prevent flash
body.theme-changing * {
  transition: none !important;
}